{"version":3,"file":"SignUp.stories-c6a1d04c.js","sources":["../../src/Pages/SignUp.jsx"],"sourcesContent":["import HomeLayout from \"../Layout/HomeLayout\";\r\nimport { useContext, useState } from \"react\";\r\nimport { AuthContext } from \"../Context/UserAuthContext\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { validateUserForm } from \"../services/HandleFormValidation/HandleFormValidation\";\r\nimport { addDoc, collection, getDocs, query, where } from \"firebase/firestore\";\r\nimport { firestoreAuth, firestoreDb } from \"../Utils/Firebase\";\r\nimport { PiSpinnerBold } from \"react-icons/pi\";\r\nimport { AiOutlineEye, AiOutlineEyeInvisible } from \"react-icons/ai\";\r\nimport { updateProfile } from \"firebase/auth\";\r\nimport {\r\n  toastMessageError,\r\n  toastMessageSuccess,\r\n} from \"../services/ToastMessage/ToastMessage\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { loginUser } from \"../Store/authSlice\";\r\nconst SignUp = () => {\r\n  const dispatch = useDispatch();\r\n  const { signUp } = useContext(AuthContext);\r\n  const [formValues, setFormValues] = useState([]);\r\n  const [formErrors, setFormErrors] = useState({});\r\n  const [togglePassword, setTogglePassword] = useState(\"password\");\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  // functions\r\n  const handleTogglePassword = () => {\r\n    if (togglePassword === \"text\") {\r\n      setTogglePassword(\"password\");\r\n    }\r\n\r\n    if (togglePassword === \"password\") {\r\n      setTogglePassword(\"text\");\r\n    }\r\n  };\r\n  const handleChange = (e) => {\r\n    const { value, name } = e.target;\r\n    setFormValues({ ...formValues, [name]: value });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setFormErrors(validateUserForm(formValues));\r\n    if (\r\n      Object.keys(validateUserForm(formValues))?.length === 0 &&\r\n      formValues?.username?.trim().length > 0 &&\r\n      formValues?.password?.trim().length > 0\r\n    ) {\r\n      const userId = query(\r\n        collection(firestoreDb, \"users\"),\r\n        where(\"username\", \"==\", formValues?.username)\r\n      );\r\n      const allDocs = await getDocs(userId);\r\n\r\n      if (allDocs.docs.length != 0) {\r\n        toastMessageError(\"Username already in use.\");\r\n        setFormErrors({\r\n          [\"username\"]: \"Username already in use.\",\r\n        });\r\n      } else {\r\n        await signUp(formValues.email, formValues.password)\r\n          .then(async (res) => {\r\n            dispatch(\r\n              loginUser({\r\n                email: res.user.email,\r\n                uid: res.user.uid,\r\n                displayName: formValues.username,\r\n              })\r\n            );\r\n            if (formValues.roles === \"admin\" || formValues.roles === \"user\") {\r\n              await addDoc(collection(firestoreDb, \"users\"), {\r\n                uid: res?.user?.uid,\r\n                username: formValues.username,\r\n                email: formValues.email,\r\n                password: formValues.password,\r\n                roles: formValues.roles,\r\n              })\r\n                .then((res) => console.log(res))\r\n                .catch((err) => {\r\n                  console.log(err.code);\r\n                });\r\n            }\r\n            toastMessageSuccess(`Welcome! ${formValues?.username}`);\r\n            await updateProfile(firestoreAuth?.currentUser, {\r\n              displayName: formValues?.username,\r\n            }).then(() => {\r\n              // afterLogin();\r\n              // localStorage.setItem(\"currentUser\", JSON.stringify(res?.user));\r\n              navigate(\"/\");\r\n            });\r\n          })\r\n          .catch((err) => {\r\n            if (err.code === \"auth/email-already-in-use\") {\r\n              toastMessageError(\"Email already in use.\");\r\n            }\r\n            if (err.code === \"auth/too-many-requests\") {\r\n              toastMessageError(\"Too many attempts. Please wait.\");\r\n            } else {\r\n              toastMessageError(\"Error signing up.\");\r\n            }\r\n          })\r\n          .finally(() => setIsLoading(false));\r\n      }\r\n    }\r\n\r\n    if (Object.keys(validateUserForm(formValues))?.length >= 0) {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <HomeLayout>\r\n      <form\r\n        action=\"\"\r\n        onSubmit={handleSubmit}\r\n        className=\"overflow-x-hidden border-black/10 overflow-y-auto w-[20rem] sm:w-[32rem] h-[30rem] sm:h-[37rem] flex flex-col justify-start items-center p-10 bg-white border-[1px] shadow-md text-black rounded-sm gap-9\">\r\n        <p className=\"w-full flex justify-center items-center text-2xl capitalize text-blue-600 font-[600] border-b-[1px] border-black/40 py-2\">\r\n          sign up\r\n        </p>\r\n        <label\r\n          htmlFor=\"username\"\r\n          className=\"w-full flex justify-center items-center flex-col text-sm gap-1\">\r\n          <input\r\n            type=\"text\"\r\n            name=\"username\"\r\n            id=\"username\"\r\n            required\r\n            onChange={handleChange}\r\n            className=\"border-[1px] outline-0 p-1 px-3 h-[2.7rem] w-full sm:w-[25rem] border-black/40  rounded-sm focus:outline focus:outline-2 focus:outline-blue-300 focus:outline-offset-1 focus:border-blue-500\"\r\n            placeholder=\"User Name\"\r\n          />\r\n          {formErrors.username && (\r\n            <span className=\"w-[95%] px-[2px] h-[1.5rem]  text-rose-400\">\r\n              {formErrors.username}\r\n            </span>\r\n          )}\r\n        </label>\r\n        <label\r\n          htmlFor=\"email\"\r\n          className=\"w-full flex justify-center items-center flex-col text-sm gap-1\">\r\n          <input\r\n            type=\"email\"\r\n            name=\"email\"\r\n            required\r\n            id=\"email\"\r\n            onChange={handleChange}\r\n            className=\"relative border-[1px] outline-0 p-1 px-3 h-[2.7rem] w-full sm:w-[25rem] border-black/40  rounded-sm focus:outline focus:outline-2 focus:outline-blue-300 focus:outline-offset-1 focus:border-blue-500\"\r\n            placeholder=\"Email\"\r\n          />\r\n\r\n          {formErrors.email && (\r\n            <span className=\"w-[95%] px-[2px] h-auto text-rose-400\">\r\n              {formErrors.email}\r\n            </span>\r\n          )}\r\n        </label>\r\n        <label\r\n          htmlFor=\"Password\"\r\n          className=\"w-full relative flex justify-center items-center flex-col text-sm gap-1\">\r\n          <input\r\n            type={togglePassword}\r\n            name=\"password\"\r\n            required\r\n            id=\"Password\"\r\n            maxLength={10}\r\n            onChange={handleChange}\r\n            className=\" border-[1px] outline-0 p-1 h-[2.7rem] px-3 pr-10 w-full sm:w-[25rem] border-black/40 rounded-sm focus:outline focus:outline-2 focus:outline-blue-300 focus:outline-offset-1 focus:border-blue-500\"\r\n            placeholder=\"Password\"\r\n          />\r\n          <span\r\n            className=\"absolute right-6 top-[0.67rem] cursor-pointer hover:bg-gray-300/80 text-black/80 flex justify-center items-center p-[2px] rounded-full\"\r\n            onClick={handleTogglePassword}>\r\n            {togglePassword === \"text\" ? (\r\n              <AiOutlineEye size={20} />\r\n            ) : (\r\n              <AiOutlineEyeInvisible size={20} />\r\n            )}\r\n          </span>\r\n          {formErrors?.password && (\r\n            <span className=\"relative w-[95%] px-[2px] h-auto text-rose-400\">\r\n              {formErrors.password}\r\n            </span>\r\n          )}\r\n        </label>\r\n        <label\r\n          htmlFor=\"Role\"\r\n          className=\"w-full flex justify-center items-center flex-col text-sm gap-1\">\r\n          <select\r\n            type=\"text\"\r\n            name=\"roles\"\r\n            id=\"roles\"\r\n            required\r\n            defaultValue={\"\"}\r\n            onChange={handleChange}\r\n            className=\"appearance-none border-[1px] outline-0 p-1 h-[2.7rem] px-3 w-full sm:w-[25rem] border-black/40 rounded-sm focus:outline focus:outline-2 focus:outline-blue-300 focus:outline-offset-1 focus:border-blue-500\"\r\n            placeholder=\"Select Role\">\r\n            <option value=\"\" disabled hidden>\r\n              Select Role\r\n            </option>\r\n            <option value=\"admin\">Admin</option>\r\n            <option value=\"user\">User</option>\r\n          </select>\r\n          {formErrors.roles && (\r\n            <span className=\"w-[95%] px-[2px] h-auto text-rose-4000\">\r\n              {formErrors.roles}\r\n            </span>\r\n          )}\r\n        </label>\r\n\r\n        <button\r\n          disabled={isLoading}\r\n          type=\"submit\"\r\n          className={`w-full sm:w-[25rem] capitalize bg-blue-600 flex justify-center  items-center min-h-[2.7rem] p-0 rounded-[3px] text-sm font-[500] text-white border-[1px] border-blue-200 hover:bg-blue-500 hover:border-blue-300 ${\r\n            isLoading ? \"cursor-not-allowed\" : \"cursor-pointer\"\r\n          } `}>\r\n          {isLoading ? (\r\n            <PiSpinnerBold size={30} className=\"animate-spin \" />\r\n          ) : (\r\n            \"Sign Up\"\r\n          )}\r\n        </button>\r\n\r\n        <div className=\"w-full flex justify-center items-center gap-1 text-gray-700 flex-wrap\">\r\n          Already Have an account?{\" \"}\r\n          <Link\r\n            to=\"/signin\"\r\n            className=\"underline underline-offset-2 decoration-1 italic hover:no-underline text-blue-500\">\r\n            Sign In\r\n          </Link>\r\n        </div>\r\n      </form>\r\n    </HomeLayout>\r\n  );\r\n};\r\n\r\nexport default SignUp;\r\n"],"names":["SignUp","dispatch","useDispatch","signUp","useContext","AuthContext","formValues","setFormValues","useState","formErrors","setFormErrors","togglePassword","setTogglePassword","isLoading","setIsLoading","navigate","useNavigate","handleTogglePassword","handleChange","e","value","name","handleSubmit","validateUserForm","_a","_b","_c","userId","query","collection","firestoreDb","where","getDocs","toastMessageError","res","loginUser","addDoc","err","toastMessageSuccess","updateProfile","firestoreAuth","_d","HomeLayout","jsxs","jsx","AiOutlineEye","AiOutlineEyeInvisible","PiSpinnerBold","Link","SignUp$1"],"mappings":"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"}